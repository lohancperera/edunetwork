<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduNetwork - Social Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background-color: #1877f2; position: sticky; top: 0; z-index: 1000; }
        .post-card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .chat-container { position: fixed; bottom: 0; right: 20px; width: 300px; background: white; border: 1px solid #ccc; border-radius: 8px 8px 0 0; }
        #message-area { height: 250px; overflow-y: auto; padding: 10px; background: #f9f9f9; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark shadow-sm">
    <div class="container d-flex justify-content-between">
        <a class="navbar-brand fw-bold fs-3" href="#">EduNetwork</a>
        <input type="text" id="searchInput" class="form-control w-50 rounded-pill" placeholder="à¶´à·à·ƒà·Šà¶§à·Š à·ƒà·œà¶ºà¶±à·Šà¶±..." onkeyup="searchPosts()">
    </div>
</nav>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card p-3 mb-4 shadow-sm border-0">
                <textarea id="postContent" class="form-control mb-2 border-0" rows="3" placeholder="à¶…à¶¯ à¶”à¶¶à·š à¶…à¶¯à·„à·ƒ à¶šà·”à¶¸à¶šà·Šà¶¯?"></textarea>
                <div class="d-flex justify-content-between align-items-center">
                    <input type="file" id="postImage" class="form-control form-control-sm w-50">
                    <button onclick="submitPost()" class="btn btn-primary px-4 fw-bold">Post à¶šà¶»à¶±à·Šà¶±</button>
                </div>
            </div>

            <div id="newsFeed"></div>
        </div>
    </div>
</div>

<div class="chat-container shadow-lg">
    <div class="bg-primary text-white p-2 fw-bold d-flex justify-content-between">
        <span>Community Chat</span>
    </div>
    <div id="message-area"></div>
    <div class="p-2 border-top bg-light">
        <input type="text" id="chatInput" class="form-control form-control-sm" placeholder="à¶¸à·à·ƒà·šà¶¢à·Š à¶‘à¶šà¶šà·Š à¶½à·’à¶ºà¶±à·Šà¶±...">
    </div>
</div>

<script>
    const socket = io('http://localhost:5000');
    const SERVER_URL = 'http://localhost:5000';

    // 1. à¶´à·à·ƒà·Šà¶§à·Š à¶‘à¶šà¶šà·Š à¶ºà·à·€à·“à¶¸
    async function submitPost() {
        const content = document.getElementById('postContent').value;
        const imageFile = document.getElementById('postImage').files[0];

        if(!content && !imageFile) return alert("à¶šà¶»à·”à¶«à·à¶šà¶» à¶ºà¶¸à¶šà·Š à¶½à·’à¶ºà¶±à·Šà¶±!");

        const formData = new FormData();
        formData.append('content', content);
        if(imageFile) formData.append('image', imageFile);
        formData.append('user', 'User');

        await fetch(`${SERVER_URL}/api/posts`, { method: 'POST', body: formData });
        document.getElementById('postContent').value = '';
        document.getElementById('postImage').value = '';
        loadPosts();
    }

    // 2. à·ƒà·’à¶ºà¶½à·”à¶¸ à¶´à·à·ƒà·Šà¶§à·Š à¶´à·™à¶±à·Šà·€à·“à¶¸
    async function loadPosts() {
        const res = await fetch(`${SERVER_URL}/api/posts`);
        const posts = await res.json();
        renderPosts(posts);
    }

    function renderPosts(posts) {
        const feed = document.getElementById('newsFeed');
        feed.innerHTML = '';
        posts.forEach(p => {
            feed.innerHTML += `
                <div class="post-card border">
                    <div class="d-flex align-items-center mb-2">
                        <div class="bg-primary text-white rounded-circle p-2 me-2">ðŸ‘¤</div>
                        <div class="fw-bold">User</div>
                    </div>
                    <p>${p.content}</p>
                    ${p.image ? `<img src="${SERVER_URL}/uploads/${p.image}" class="img-fluid rounded mb-2">` : ''}
                    <div class="border-top pt-2 mt-2">
                        <button class="btn btn-light btn-sm w-50">Like</button>
                        <button class="btn btn-light btn-sm w-50">Comment</button>
                    </div>
                </div>`;
        });
    }

    // 3. à·ƒà·™à·€à·”à¶¸à·Š à¶´à¶¯à·Šà¶°à¶­à·’à¶º (Search)
    async function searchPosts() {
        const query = document.getElementById('searchInput').value;
        if(query.length < 2) return loadPosts();
        const res = await fetch(`${SERVER_URL}/api/search?q=${query}`);
        const results = await res.json();
        renderPosts(results);
    }

    // 4. Chat à¶šà·Šâ€à¶»à·’à¶ºà·à¶šà·à¶»à·’à¶­à·Šà·€à¶º
    document.getElementById('chatInput').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') {
            socket.emit('send_message', { msg: e.target.value, user: 'à¶”à¶¶' });
            e.target.value = '';
        }
    });

    socket.on('receive_message', (data) => {
        const area = document.getElementById('message-area');
        area.innerHTML += `<div><strong>${data.user}:</strong> ${data.msg}</div>`;
        area.scrollTop = area.scrollHeight;
    });

    loadPosts();
</script>
</body>
</html>